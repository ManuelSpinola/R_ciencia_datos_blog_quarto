---
title: "Uso y cobertura de la tierra en Costa Rica - 2021"
subtitle: Uso y cobertura de la tierra en Costa rica con una resolución de 10 metros
image: "imagenes/cr_satelite_3d.png"
author:
  - name: Manuel Spínola
    url: http://www.icomvis.una.ac.cr/index.php/manuel
    affiliation: ICOMVIS - UNA
    affiliation-url: http://www.icomvis.una.ac.cr/
    orcid: 0000-0002-7839-1908

format:
  html:
    embed-resources: true

date: 2022-12-06
citation: true
toc: true
toc-title: Tabla de contenido
toc-location: left
toc-depth: 4
bibliography: references.bib
lang: es
draft: false
execute: 
  echo: false
  include: false
categories:
  - "Análisis y Visualización de Datos"
---

```{r}
#| message: false
#| warning: false
library(tidyverse)
library(rio)
library(knitr)
library(sf)
library(stars)
library(raster)
library(rasterVis)
library(terra)
library(tidyterra)
library(rnaturalearth)
library(rmapshaper)
library(exactextractr)
library(landscapemetrics)
library(landscapetools)
library(motif)
library(supercells)
library(arcpullr)
library(basemaps)
library(rayshader)
library(elevatr)
library(here)
library(treemapify)
library(ggthemes)
library(ggdark)
library(patchwork)
```

# Definición

El Uso y Cobertura de la tierra se refiere a la categorización o clasificación de las actividades humanas y elementos naturales del paisaje dentro de un marco de tiempo específico.

```{r}
#| include: true
#| out-width: 100%
#| column: page
#| label: fig-satelite
#| fig-cap: Mapa 3D de Costa Rica.
include_graphics("imagenes/cr_satelite_3d.png")
```

# Uso y cobertura de la tierra en Costa Rica - 2021

Para el análisis usé el producto ESA WorldCover cobertura de la tierra [@Zanaga2021-cf]. Este producto se basa en la clasisficación de 11 clases definidas por el Sistema de Clasificación de Cobertura de la Organización de las Naciones Unidas y la Organización de las Naciones Unidas para la Alimentación y la Agricultura (FAO). Las categorías consideradas no necesariamente reflejan exactamente el actual uso de la tierra. Por ejemplo, este producto sobrestima la cobertura de pastizales [@Venter2022-cw]. Por lo tanto, las intepretaciones sobre las extensiones de cada categoría deben realizarse con cautela.

```{r}
cr <- st_read("vectors/cr_5367.gpkg")
```

```{r}
cr_r <- rast("rasters/lulc_cr_categorical_5367.tif")
```

```{r}
#| include: true
#| message: false
#| warning: false
#| label: fig-cobertura
#| fig-cap: "Mapa del uso y cobertura de la tierra en Costa Rica con una resolución de 10m, 2021."
ggplot() +
  dark_theme_minimal() +
  geom_spatraster(data = cr_r, na.rm = TRUE) +
  scale_fill_manual(name = "Tipo de cobertura", values = c("darkgreen", "orange", "yellow", "magenta", "red", "grey", "blue", "#0096A0",  "#00CF75"), na.value = "transparent", na.translate = FALSE)
```

```{r}
ca <- rast("rasters/ca.tif")
pa <- rast("rasters/pa.tif")
cu <- rast("rasters/cu.tif")
ze <- rast("rasters/ze.tif")
hh <- rast("rasters/hh.tif")
mg <- rast("rasters/mg.tif")
```

```{r}
st <- c(ca, pa, cu, ze, hh, mg)
st
```

```{r}
names(st) <- c("Cobertura arbórea", "Pastizales", "Cultivos", "Zonas edificadas", "Humedales herbáceos", "Manglar")
```

```{r}
ggplot() +
  theme_map() +
  geom_spatvector(data = cr, fill = "white") +
  geom_spatraster(data = st) +
  facet_wrap(~lyr) +
  scale_fill_manual(values = c("green", "red"), na.value = "transparent") +
  theme(legend.position = "none")
```

```{r}
pca <- ggplot() +
  theme_map() +
  geom_spatvector(data = cr, fill = "white") +
  geom_spatraster(data = ca) +
  scale_fill_manual(values = "darkgreen", na.value = "transparent", na.translate = FALSE) +
  theme(legend.position = "none") +
  ggtitle("Cobertura arbórea")
pca
```

```{r}
ppa <- ggplot() +
  theme_map() +
  geom_spatvector(data = cr, fill = "white") +
  geom_spatraster(data = pa) +
  scale_fill_manual(values = "yellow", na.value = "transparent", na.translate = FALSE) +
  theme(legend.position = "none") +
  ggtitle("Pastizales")
ppa
```

```{r}
pcu <- ggplot() +
  theme_map() +
  geom_spatvector(data = cr, fill = "white") +
  geom_spatraster(data = cu) +
  scale_fill_manual(values = "magenta", na.value = "transparent", na.translate = FALSE) +
  theme(legend.position = "none") +
  ggtitle("Cultivos")
pcu
```

```{r}
pze <- ggplot() +
  theme_map() +
  geom_spatvector(data = cr, fill = "white") +
  geom_spatraster(data = ze) +
  scale_fill_manual(values = "tomato", na.value = "transparent", na.translate = FALSE) +
  theme(legend.position = "none") +
  ggtitle("Zonas edificadas")
pze
```

```{r}
phh <- ggplot() +
  theme_map() +
  geom_spatvector(data = cr, fill = "white") +
  geom_spatraster(data = hh) +
  scale_fill_manual(values = "#0096A0", na.value = "transparent", na.translate = FALSE) +
  theme(legend.position = "none") +
  ggtitle("Humedales herbáceos")
phh
```

```{r}
pmg <- ggplot() +
  theme_map() +
  geom_spatvector(data = cr, fill = "white") +
  geom_spatraster(data = mg) +
  scale_fill_manual(values = "#00CF75", na.value = "transparent", na.translate = FALSE) +
  theme(legend.position = "none") +
  ggtitle("Manglar")
pmg
```

```{r}
p1 <- pca + ppa + pcu
```

```{r}
p2 <- pze + phh + pmg
```

```{r}
#| include: true
#| message: false
#| warning: false
#| label: fig-cobertura_b
#| fig-cap: "Mapa de 6 categorías de uso y cobertura de la tierra en Costa Rica, 2021."
p1 / p2
```

La mayor superficie de cobetura correspondió a la cobertura arbórea (74%), seguida de los pastizales (21%) (@fig-cobertura, @fig-cobertura_b, @fig-porcentajes). Sin embrago, como se mencionó anteriormente, algunos usos y coberturas de la tierra pueden ser subestimados o sobreestimados, por lo que se requiere precaución en la intepretación de los porcentajes.

```{r}
area_table <- import("df/area_table.xlsx")
area_table
```

```{r}
#| include: true
#| label: fig-porcentajes
#| fig-cap: Porcentaje de los tipos de uso y cobertura de la tierra en Costa Rica, 2021.
ggplot(area_table, aes(area = p, fill = value, label = paste(value, porc,sep = "\n"))) +
  geom_treemap() +
  geom_treemap_text(grow = F,
                    reflow = T,
                    colour = "black", 
                    place = "centre",
                    size = 10) +
  scale_fill_tableau()
```

# Pixeles con similares características (superpixeles)

Los superpixeles son una colección de conceptos de segmentación que agrupan pixeles con características similares. Se determinaron 533 superpixeles que muestran un uso y cobertura de la tierra similares (@fig-superpixeles).

```{r}
slic <- st_read("supercells/supercells.gpkg")
```

```{r}
#| include: true
#| message: false
#| warning: false
#| label: fig-superpixeles
#| fig-cap: Superpixeles del uso y cobertura de la tierra de Costa Rica, 2021. 
ggplot() +
  dark_theme_minimal() +
  geom_spatraster(data = cr_r, na.rm = TRUE) +
  scale_fill_manual(name = "Tipo de cobertura", values = c("darkgreen", "orange", "yellow", "magenta", "red", "grey", "blue", "#0096A0",  "#00CF75"), na.value = "transparent", na.translate = FALSE) +
  geom_sf(data = slic, alpha = 0, color = "white")
```

El análisis lo realicé con R [@R2022], usando los paquetes supercells [@Nowosad2021], sf [@Pebesma2018], terra [@Hijmans2022] y ggplot2 [@Wickham2016].

# Literatura citada

::: {#refs}
:::
