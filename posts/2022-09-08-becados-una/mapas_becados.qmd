---
title: "Visualización de datos de los estudiantes becados en la UNA"
subtitle: Becados en la UNA 2019 - 2022
image: "imagenes/wordcloud.png"
author:
  - name: Manuel Spínola
    url: http://www.icomvis.una.ac.cr/index.php/manuel
    affiliation: ICOMVIS - UNA
    affiliation-url: http://www.icomvis.una.ac.cr/
    orcid_id: 0000-0002-7839-1908
date: 2022-09-28
citation: true
toc: true
toc-title: Tabla de contenido
toc-location: left
toc-depth: 4
bibliography: references.bib
lang: es
draft: true
execute: 
  echo: false
  include: false
categories:
  - "Visualización de datos"
---

```{r}
#| message: false
#| warning: false
#| include: false
library(tidyverse)
library(readxl)
library(rio)
library(sf)
library(sfExtras)
library(stars)
library(raster)
library(terra)
library(mapview)
library(rnaturalearth)
library(rnaturalearthhires)
library(rmapshaper)
library(janitor)
library(mapsf)
library(tmap)
library(tmaptools)
library(rayshader)
library(ggthemes)
library(cartogram)
```

```{r}
df <- read_excel("datos/estudiantes_becados_una.xlsx") |>
  clean_names() |>
  mutate(provincia = str_to_title(provincia))
```

```{r}
glimpse(df)
```

```{r}
provincia <- df |>
  group_by(provincia, tipo_de_beca, ano)
```

```{r}
cr <- st_read("datos/ign_costa_rica_2017_5k.gpkg") |>
  rmapshaper::ms_simplify() |>
  st_transform(crs = 5367)
```

```{r}
cr <- ms_filter_islands(cr, min_area = 1000000000)
```

```{r}
prov <- st_read("datos/ign_provincias_5k.gpkg") |>
  rmapshaper::ms_simplify() |>
  st_transform(crs = 5367) |>
  st_intersection(cr)
cant <- st_read("datos/ign_cantones_5k.gpkg") |>
  rmapshaper::ms_simplify() |>
  st_transform(crs = 5367) |>
  st_intersection(cr)
dist <- st_read("datos/ign_distritos_5k.gpkg") |>
  rmapshaper::ms_simplify() |>
  st_transform(crs = 5367) |>
  st_intersection(cr)
```

```{r}
ggplot() +
  geom_sf(data = prov) +
  geom_sf(data = cant)
```

```{r}
df_prov <- merge(prov, df, by = "provincia")
```

```{r}
n_prov <- df_prov |>
  group_by(ano, provincia) |>
  count()
n_prov
```

```{r}
#| include: true
gg_01 <- ggplot(n_prov) +
  theme_map() +
  geom_sf(aes(fill = n), color = "gray90", size = 0.05) +
  facet_wrap(~ ano, ncol = 4) +
  geom_sf_label(aes(label = n), label.padding = unit(0.1, "lines"), size = 1) +
  scale_fill_viridis_c(name = "Número de becados", option = "C") +
  theme(legend.position = "bottom",
        strip.background = element_blank()) +
  theme(legend.key.height = unit(0.4, 'cm'))
gg_01
```

```{r}
n_prov_carto <- cartogram_ncont(n_prov, weight = "n")
```

```{r}
n_prov_carto
```

```{r}
#| include: true
gg_02 <- ggplot(n_prov_carto) +
  theme_map() +
  geom_sf(data = prov, fill = "gray85", color = "black", size = 0.05) +
  geom_sf(aes(fill = n), color = "gray90", size = 0.05) +
  facet_wrap(~ ano, ncol = 4) +
  geom_sf_label(aes(label = n), label.padding = unit(0.1, "lines"), size = 1) +
  scale_fill_viridis_c(name = "Número de becados", option = "C") +
  theme(legend.position = "bottom",
        strip.background = element_blank()) +
  theme(legend.key.height = unit(0.4, 'cm'))
gg_02
```

```{r}
centroides_prov <- st_centroid(n_prov)
centroides_prov
```

```{r}
#| include: true
gg_03 <- ggplot(n_prov) +
  theme_map() +
  geom_sf(data = prov, fill = "gray80", color = "black", size = 0.1) +
  geom_sf(data = centroides_prov, aes(size = n, fill = n), pch = 21) +
  facet_wrap(~ ano, ncol = 4) +
  geom_sf_label(data = centroides_prov, aes(label = n), label.padding = unit(0.1, "lines"), size = 1) +
  scale_size_continuous(name = "Número de becados", range = c(1, 9),
             guide = guide_legend(direction = "horizontal", nrow = 1, label.position = "bottom")) +
  scale_fill_viridis_c(name = "Número de becados", guide = "legend") +
  theme(legend.position = "bottom",
        strip.background = element_blank())
gg_03
```

```{r}
tm_shape(n_prov) +
  tm_polygons(col = "n", n = 6) +
  tm_facets(by = "ano", ncol = 2) +
  tm_layout()
```

El análisis lo realicé con R [@R2022], usando los paquetes quanteda [@Benoit2018] y factoextra [@Kassambara2020].

Literatura citada
