{
  "hash": "c5de9e3983ec097372575b8f4a788b99",
  "result": {
    "markdown": "---\ntitle: \"Distribucion de Especies\"\ndescription: |\n  A short description of the post.\nauthor:\n  - name: Manuel Spínola\n    url: http://www.icomvis.una.ac.cr/index.php/manuel\n    affiliation: ICOMVIS - UNA\n    affiliation_url: http://www.icomvis.una.ac.cr/\n    orcid: 0000-0002-7839-1908\ndate: 2022/02/02\ncitation: true\n---\n\n\n\n# Pasos a seguir\n\n### Definir área de estudio\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ca[\"iso_a3\"])\n```\n\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nca_dissolved <- st_union(ca)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ca_dissolved)\n```\n\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n### Búsqueda de registros\n\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naa_sf\n```\n\n::: {.cell-output-stdout}\n```\nSimple feature collection with 339 features and 2 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -101.6384 ymin: 8.567432 xmax: -76.7442 ymax: 26.03637\nGeodetic CRS:  WGS 84\n# A tibble: 339 × 3\n   scientificName                      country                 geometry\n * <chr>                               <chr>                <POINT [°]>\n 1 Amazona auropalliata (Lesson, 1842) Nicaragua   (-85.62582 11.09022)\n 2 Amazona auropalliata (Lesson, 1842) Costa Rica  (-85.58888 10.81898)\n 3 Amazona auropalliata (Lesson, 1842) Guatemala   (-91.02262 14.45619)\n 4 Amazona auropalliata (Lesson, 1842) Costa Rica  (-84.68904 9.624969)\n 5 Amazona auropalliata (Lesson, 1842) Costa Rica  (-84.63615 9.693081)\n 6 Amazona auropalliata (Lesson, 1842) Honduras    (-86.33173 16.46489)\n 7 Amazona auropalliata (Lesson, 1842) Costa Rica    (-84.74223 9.7992)\n 8 Amazona auropalliata (Lesson, 1842) Guatemala   (-90.43126 14.46031)\n 9 Amazona auropalliata (Lesson, 1842) Costa Rica     (-85.77 10.90312)\n10 Amazona auropalliata (Lesson, 1842) El Salvador  (-89.3336 13.66678)\n# … with 329 more rows\n```\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n### Variables explicativas\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbio <- merge(bio_01, bio_02)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(bio)\n```\n\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nalt_01 <- getData(\"worldclim\", var = \"alt\", res = 0.5, lon = - 89, lat = 14)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nalt_02 <- getData(\"worldclim\", var = \"alt\", res = 0.5, lon = - 100, lat = 23)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nalt <- merge(alt_01, alt_02)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(alt)\n```\n\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbio <- stack(bio, alt)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbio_c <- crop(bio, ca)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbio_ca <- mask(bio_c, ca)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(bio_ca)\n```\n\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n# Balanced random forest (Valavi et al 2021)\n\n### Datos de presencia y background\n\n::: {.cell}\n\n```{.r .cell-code}\n# datos presencia\npresencia <- st_coordinates(aa_ca_sf) |>\n  as.data.frame() |>\n  rename(x = X, y = Y)\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# localizaciones de background (pseudo-absences)\nbackground <- randomPoints(bio_ca$layer.1, 12500, p = aa_ca_sp, excludep = TRUE) |>\n  as.data.frame()\n```\n:::\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_todos <- drop_na(data_todos)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(data_todos)\n```\n\n::: {.cell-output-stdout}\n```\n  pa           layer.1         layer.2          layer.3         layer.4    \n no:12500   Min.   : 66.0   Min.   : 59.00   Min.   :56.00   Min.   : 201  \n si:  168   1st Qu.:232.0   1st Qu.: 84.00   1st Qu.:67.00   1st Qu.: 735  \n            Median :251.0   Median : 98.00   Median :72.00   Median : 906  \n            Mean   :240.9   Mean   : 97.33   Mean   :71.06   Mean   :1032  \n            3rd Qu.:261.0   3rd Qu.:109.00   3rd Qu.:75.00   3rd Qu.:1382  \n            Max.   :283.0   Max.   :137.00   Max.   :88.00   Max.   :2034  \n    layer.5         layer.6         layer.7         layer.8         layer.9   \n Min.   :117.0   Min.   :-12.0   Min.   : 78.0   Min.   : 69.0   Min.   : 56  \n 1st Qu.:303.0   1st Qu.:157.0   1st Qu.:119.0   1st Qu.:234.0   1st Qu.:229  \n Median :315.0   Median :183.0   Median :138.0   Median :253.0   Median :249  \n Mean   :310.9   Mean   :174.3   Mean   :136.5   Mean   :243.1   Mean   :239  \n 3rd Qu.:330.0   3rd Qu.:200.0   3rd Qu.:155.0   3rd Qu.:261.0   3rd Qu.:261  \n Max.   :374.0   Max.   :229.0   Max.   :191.0   Max.   :290.0   Max.   :285  \n    layer.10        layer.11        layer.12       layer.13    \n Min.   : 72.0   Min.   : 55.0   Min.   : 634   Min.   :142.0  \n 1st Qu.:244.0   1st Qu.:215.0   1st Qu.:1559   1st Qu.:270.0  \n Median :262.0   Median :234.0   Median :1975   Median :342.0  \n Mean   :252.8   Mean   :226.5   Mean   :2178   Mean   :360.2  \n 3rd Qu.:272.0   3rd Qu.:249.0   3rd Qu.:2709   3rd Qu.:427.0  \n Max.   :297.0   Max.   :273.0   Max.   :5787   Max.   :946.0  \n    layer.14         layer.15         layer.16         layer.17    \n Min.   :  0.00   Min.   : 20.00   Min.   : 302.0   Min.   :  0.0  \n 1st Qu.:  9.00   1st Qu.: 51.75   1st Qu.: 694.0   1st Qu.: 45.0  \n Median : 31.00   Median : 60.00   Median : 898.0   Median :116.5  \n Mean   : 36.65   Mean   : 64.38   Mean   : 936.8   Mean   :136.1  \n 3rd Qu.: 53.00   3rd Qu.: 77.00   3rd Qu.:1129.0   3rd Qu.:190.0  \n Max.   :221.00   Max.   :112.00   Max.   :2335.0   Max.   :754.0  \n    layer.18         layer.19          layer       \n Min.   :  28.0   Min.   :   3.0   Min.   :  -2.0  \n 1st Qu.: 325.0   1st Qu.: 165.0   1st Qu.:  64.0  \n Median : 430.0   Median : 343.0   Median : 235.0  \n Mean   : 468.4   Mean   : 401.3   Mean   : 475.9  \n 3rd Qu.: 592.0   3rd Qu.: 522.0   3rd Qu.: 699.0  \n Max.   :1737.0   Max.   :1982.0   Max.   :3714.0  \n```\n:::\n:::\n\n### package randomForest\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_b\n```\n\n::: {.cell-output-stdout}\n```\n\nCall:\n randomForest(formula = pa ~ ., data = data_todos, ntree = 1000,      sampsize = c(158, 158), replace = TRUE, importance = TRUE) \n               Type of random forest: classification\n                     Number of trees: 1000\nNo. of variables tried at each split: 4\n\n        OOB estimate of  error rate: 10.73%\nConfusion matrix:\n      no   si class.error\nno 11178 1322   0.1057600\nsi    37  131   0.2202381\n```\n:::\n:::\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstars_rf <- st_as_stars(raster_rf)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  theme_minimal() +\n  geom_stars(data = stars_rf) +\n  geom_sf(data = ca, fill = NA) +\n  scale_fill_viridis_c(name = \"Probabilidad\", na.value = \"transparent\", option = \"B\", direction = -1)\n```\n\n::: {.cell-output-display}\n![](distribucion-de-especies_files/figure-html/unnamed-chunk-49-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstars_rf\n```\n\n::: {.cell-output-stdout}\n```\nstars object with 2 dimensions and 1 attribute\nattribute(s), summary of first 1e+05 cells:\n        Min. 1st Qu. Median       Mean 3rd Qu.  Max.  NA's\nlayer  0.012   0.027  0.032 0.03318132   0.039 0.059 97055\ndimension(s):\n  from   to  offset       delta                       refsys point values x/y\nx    1 1810  -92.25  0.00833333 +proj=longlat +datum=WGS8...    NA   NULL [x]\ny    1 1354 18.4917 -0.00833333 +proj=longlat +datum=WGS8...    NA   NULL [y]\n```\n:::\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_metric(data_todos, data_todos$pa, estimate = y_pred)\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 3 × 3\n  .metric  .estimator .estimate\n  <chr>    <chr>          <dbl>\n1 accuracy binary         0.893\n2 kap      binary         0.141\n3 f_meas   binary         0.943\n```\n:::\n:::",
    "supporting": [
      "distribucion-de-especies_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": [],
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}