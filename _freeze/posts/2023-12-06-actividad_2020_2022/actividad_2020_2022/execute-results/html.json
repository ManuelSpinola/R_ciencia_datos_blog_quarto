{
  "hash": "ec0dcf7f9d7e571e3f9215734704c538",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Flujo de trabajo para la evaluación del cambio climático en la biodiversidad de América Central mediante el uso de datos abiertos y software libre\"\nsubtitle: \"El uso de datos abiertos y software libre para evaluar el impacto del cambio climático sobre la biodiversidad en América Central\"\nimage: \"imagenes/ac_circle.png\"\nformat:\n  html:\n    embed-resources: true\nauthor:\n  - name: Manuel Spínola\n    url: http://www.icomvis.una.ac.cr/index.php/manuel\n    affiliation: ICOMVIS - UNA\n    affiliation-url: http://www.icomvis.una.ac.cr/\n    orcid: 0000-0002-7839-1908\n    \n  - name: Joel Sáenz\n    url: https://www.icomvis.una.ac.cr/index.php/joel\n    affiliation: ICOMVIS - UNA\n    affiliation-url: http://www.icomvis.una.ac.cr/\n\n  - name: Mónica Retamosa\n    url: https://www.icomvis.una.ac.cr/index.php/monica\n    affiliation: ICOMVIS - UNA\n    affiliation-url: http://www.icomvis.una.ac.cr/\n    orcid: 0000-0002-4010-2998\n\ndate: \"2024-01-08\"\ncitation: true\ntoc: true\ntoc-title: Tabla de contenido\ntoc-location: left\ntoc-depth: 4\nbibliography: references.bib\nlang: es\ndraft: false\nexecute: \n  echo: false\n  include: false\ncode-fold: true\ncode-summary: \"Show the code\"\ncategories:\n  - \"Cambio climático\"\n  - \"Distribución de especies\"\n  - \"Biodiversidad\"\n  - \"Datos abiertos\"\n  - \"Software libre\"\n---\n\n\n\n# Modelaje de la distribución actual de la rana verde de ojos rojos\n\nEste es un flujo de trabajo de como realizar un análisis del impacto del cambio climático sobre la biodiversidad en América Central. En este caso utilizamos como ejemplo la rana verde de ojos rojos (*Agalychnis callidryas*).\n\n![](imagenes/ac_circle.png){fig-align=\"center\" width=\"20%\"}\n\nPara poder realizar el análisis es necesario instalar y cargar los siguientes paquetes de R [@R2023].\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(spocc)\nlibrary(sf)\nlibrary(stars)\nlibrary(terra)\nlibrary(tidyterra)\nlibrary(predicts)\nlibrary(cageo)\nlibrary(paisaje)\nlibrary(ggsankey)\nlibrary(gt)\n```\n:::\n\n\n\n::: callout-note\nLos paquetes [cageo](https://github.com/ManuelSpinola/cageo), [paisaje](https://github.com/ManuelSpinola/paisaje) y [ggsankey](https://github.com/davidsjoberg/ggsankey) se deben bajar desde el enlace que se provee al pinchar en los respectivos nombres.\n:::\n\n## 1. Obtención de los límites del área de estudio\n\nPara obtener los límites de América Central usamos el mapa **ca_outline_d** que se incluye en el paquete de R, cageo [@Spínola2023_a]\n\n::: callout-note\nEl paquete de R, **cageo** contiene datos espaciales para America Central. El paquete se desarrolló para facilitar este flujo de trabajo.\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nca <- ca_outline_d\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  theme_minimal() +\n  geom_sf(data = ca)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n## 2. Obtenención de los registros de la especie\n\nPara obtener los registros de la especie en el portal de datos [GBIF](https://www.gbif.org) usamos el paquete spocc [@Owens2023]\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nac_gbif <- occ(query = \"Agalychnis callidryas\", from = \"gbif\", has_coords = TRUE, limit = 5000, geometry = st_bbox(ca))\n```\n:::\n\n\n\nLos registros obtenidos para la región de América Central los convertimos en una estructura de datos de 2 dimensiones (filas y columnas).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nac_gbif_df <- occ2df(ac_gbif) |>\n  drop_na() |>\n  mutate_if(is.character, as.factor)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(ac_gbif_df) |> gt() |> tab_options(table.font.size = 12)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"lpzthlymxq\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#lpzthlymxq table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#lpzthlymxq thead, #lpzthlymxq tbody, #lpzthlymxq tfoot, #lpzthlymxq tr, #lpzthlymxq td, #lpzthlymxq th {\n  border-style: none;\n}\n\n#lpzthlymxq p {\n  margin: 0;\n  padding: 0;\n}\n\n#lpzthlymxq .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 12px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#lpzthlymxq .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#lpzthlymxq .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#lpzthlymxq .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#lpzthlymxq .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#lpzthlymxq .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#lpzthlymxq .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#lpzthlymxq .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#lpzthlymxq .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#lpzthlymxq .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#lpzthlymxq .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#lpzthlymxq .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#lpzthlymxq .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#lpzthlymxq .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#lpzthlymxq .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lpzthlymxq .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#lpzthlymxq .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#lpzthlymxq .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#lpzthlymxq .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lpzthlymxq .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#lpzthlymxq .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lpzthlymxq .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#lpzthlymxq .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lpzthlymxq .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#lpzthlymxq .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lpzthlymxq .gt_left {\n  text-align: left;\n}\n\n#lpzthlymxq .gt_center {\n  text-align: center;\n}\n\n#lpzthlymxq .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#lpzthlymxq .gt_font_normal {\n  font-weight: normal;\n}\n\n#lpzthlymxq .gt_font_bold {\n  font-weight: bold;\n}\n\n#lpzthlymxq .gt_font_italic {\n  font-style: italic;\n}\n\n#lpzthlymxq .gt_super {\n  font-size: 65%;\n}\n\n#lpzthlymxq .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#lpzthlymxq .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#lpzthlymxq .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#lpzthlymxq .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#lpzthlymxq .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#lpzthlymxq .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#lpzthlymxq .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#lpzthlymxq .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#lpzthlymxq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"name\">name</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"longitude\">longitude</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"latitude\">latitude</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"prov\">prov</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date\">date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"key\">key</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"name\" class=\"gt_row gt_center\">Agalychnis callidryas (Cope, 1862)</td>\n<td headers=\"longitude\" class=\"gt_row gt_right\">-84.58961</td>\n<td headers=\"latitude\" class=\"gt_row gt_right\">10.427559</td>\n<td headers=\"prov\" class=\"gt_row gt_center\">gbif</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2024-01-02</td>\n<td headers=\"key\" class=\"gt_row gt_center\">4510305838</td></tr>\n    <tr><td headers=\"name\" class=\"gt_row gt_center\">Agalychnis callidryas (Cope, 1862)</td>\n<td headers=\"longitude\" class=\"gt_row gt_right\">-84.64558</td>\n<td headers=\"latitude\" class=\"gt_row gt_right\">10.455464</td>\n<td headers=\"prov\" class=\"gt_row gt_center\">gbif</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2024-01-03</td>\n<td headers=\"key\" class=\"gt_row gt_center\">4510361946</td></tr>\n    <tr><td headers=\"name\" class=\"gt_row gt_center\">Agalychnis callidryas (Cope, 1862)</td>\n<td headers=\"longitude\" class=\"gt_row gt_right\">-84.12152</td>\n<td headers=\"latitude\" class=\"gt_row gt_right\">10.451470</td>\n<td headers=\"prov\" class=\"gt_row gt_center\">gbif</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2024-01-04</td>\n<td headers=\"key\" class=\"gt_row gt_center\">4510345248</td></tr>\n    <tr><td headers=\"name\" class=\"gt_row gt_center\">Agalychnis callidryas (Cope, 1862)</td>\n<td headers=\"longitude\" class=\"gt_row gt_right\">-84.12165</td>\n<td headers=\"latitude\" class=\"gt_row gt_right\">10.451480</td>\n<td headers=\"prov\" class=\"gt_row gt_center\">gbif</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2024-01-04</td>\n<td headers=\"key\" class=\"gt_row gt_center\">4510349158</td></tr>\n    <tr><td headers=\"name\" class=\"gt_row gt_center\">Agalychnis callidryas (Cope, 1862)</td>\n<td headers=\"longitude\" class=\"gt_row gt_right\">-82.14613</td>\n<td headers=\"latitude\" class=\"gt_row gt_right\">9.254863</td>\n<td headers=\"prov\" class=\"gt_row gt_center\">gbif</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2024-01-02</td>\n<td headers=\"key\" class=\"gt_row gt_center\">4510122523</td></tr>\n    <tr><td headers=\"name\" class=\"gt_row gt_center\">Agalychnis callidryas (Cope, 1862)</td>\n<td headers=\"longitude\" class=\"gt_row gt_right\">-84.21459</td>\n<td headers=\"latitude\" class=\"gt_row gt_right\">9.576750</td>\n<td headers=\"prov\" class=\"gt_row gt_center\">gbif</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2024-01-07</td>\n<td headers=\"key\" class=\"gt_row gt_center\">4510302449</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\nLuego convertimos los registros en un objeto espacial, donde solo nos quedamos con los registros que se incluyen en la región continental de América Central\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nac_gbif_sp <- st_as_sf(ac_gbif_df, coords = c(\"longitude\", \"latitude\"), crs = 4326) |>\n  st_intersection(ca)\n```\n:::\n\n\n\nSe remueven los registros que puedan estar duplicados\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nac_gbif_sp <- distinct(ac_gbif_sp)\n```\n:::\n\n\n\nElaboramos un mapa que muestre los registros en la región de América Central\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = ca) +\n  geom_sf(data = ac_gbif_sp)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n## 3. Preparación de las variables ambientales\n\nLas variables ambientales a utilizar en este caso son las 19 variables bioclimáticas elaboradas por [WorldClim](https://www.worldclim.org/). Para obtener las variables para la región de América Central utilizamos el paquete de R, cacc [@Spínola2023_b]\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nca_bioc <- get_worldclim_historic(var = \"bio\",\n                      res = 2.5,\n                      aoi = ca)\n```\n:::\n\n\n\n\nRealizamos un mapa de las 19 variables bioclimáticas.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ca_bioc, maxnl = 19)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n## 4. Modelación\n\n### Ajuste del modelo\n\nPara modelar la distribución de la rana verde de ojos rojos usamo el algoritmo Maxent del paquete de R, predicts [@Hijmans2023]\n\nPrimero transformamos el objeto **ac_gbif_sp** en un objeto terra\n\n\n\n\n\n\n\nLuego dividimos los registros de ocurrencia en 5 subconjuntos y se dividen los datos en un subconjunto de entrenamiento y se mantiene un 20% para poner a prueba el modelo\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsc <- folds(ac_gbif_sp_t, k=5)\ndatos_prueba <- ac_gbif_sp_t[sc == 1, ]\ndatos_entrenamiento <- ac_gbif_sp_t[sc != 1, ]\n```\n:::\n\n\n\nAjustamos el modelo de maxent\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelo_maxent <- MaxEnt(ca_bioc, datos_entrenamiento)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required namespace: rJava\n```\n\n\n:::\n:::\n\n\n\nGraficams la importancia de las variables.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(modelo_maxent)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n### Predicción\n\nPredecimos la cálidad del hábitat para la especie para la región de América Central\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_maxent <- predict(modelo_maxent, ca_bioc)\n```\n:::\n\n\n\nElaboramos un mapa con la calidad del hábitat\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  theme_minimal() +\n  geom_spatraster(data = mapa_maxent) +\n  scale_fill_whitebox_c(name = \"Calidad \\ndel hábitat\",\n                       palette = \"Bl_Yl_Rd\",\n                       na.value = NA,\n                       direction = 1)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n### Evaluación\n\nGeneramos datos de \"background\", en este caso 1000 puntos\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbg <- backgroundSample(ca_bioc, 1000)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in backgroundSample(ca_bioc, 1000): generated random points = 0.795\ntimes requested number\n```\n\n\n:::\n:::\n\n\n\nPara evaluar el modelo usamos los puntos de \"background\" con los datos de prueba que habíamos asignado previamente\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nevaluacion_01 <- pa_evaluate(modelo_maxent, p = datos_prueba, a = bg, x = ca_bioc)\n```\n:::\n\n\n\nVisualizamos diferentes métricas de evaluación\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nevaluacion_01\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n@stats\n   np  na prevalence   auc   cor pcor   ODP\n1 918 795      0.536 0.943 0.804    0 0.464\n\n@thresholds\n  max_kappa max_spec_sens no_omission equal_prevalence equal_sens_spec\n1     0.446         0.515       0.016            0.543             0.5\n\n@tr_stats\n     treshold kappa  CCR  TPR TNR FPR  FNR  PPP  NPP  MCR  OR\n1           0     0 0.54    1   0   1    0 0.54  NaN 0.46 NaN\n2           0     0 0.54    1   0   1    0 0.54    1 0.46 Inf\n3           0     0 0.54    1   0   1    0 0.54    1 0.46 Inf\n4         ...   ...  ...  ... ... ...  ...  ...  ...  ... ...\n1042     0.99  0.01 0.47 0.01   1   0 0.99    1 0.47 0.53 Inf\n1043     0.99     0 0.46    0   1   0    1  NaN 0.46 0.54 NaN\n1044     0.99     0 0.46    0   1   0    1  NaN 0.46 0.54 NaN\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nGraficamos la evaluación del modelo.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(evaluacion_01, \"ROC\")\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\nObtenemos el threshold para este modelo para usarlo en la evaluación del impacto del cambio climático.\n\n\n\n\n\n\n\n## 5. Evaluación del impacto del cambio climático\n\nPara evaluar el impacto del cambio climático sobre el hábitat de la rana verde de ojos rojos utilizamos un escenario de cambio climático.\n\nEn este caso usaremos el escenario INM-CM4-8 para SSP5-8.5 y el intervalo de tiempo 2041 - 2060.\n\n::: callout-note\nEl paquete de R, **paisaje** cuenta con funciones para bajar datos climatológicos para América Central. El paquete se desarrolló para facilitar este flujo de trabajo.\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nca_bio_2041_2060 <- get_worldclim_future(var = \"bioc\",\n                    res = \"2.5m\",\n                    gcm = \"INM-CM4-8\",\n                    scenario = \"585\",\n                    time_range = \"2041-2060\",\n                    aoi = ca)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Download URL: https://geodata.ucdavis.edu/cmip6/2.5m/INM-CM4-8/ssp585/wc2.1_2.5m_bioc_INM-CM4-8_ssp585_2041-2060.tif\"\n```\n\n\n:::\n:::\n\n\n\n\nRenombramos las 19 variables bioclimáticas con el mismo nombre de las variables usadas en el modelo para el tiempo presente.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(ca_bio_2041_2060) <- names(ca_bioc)\n```\n:::\n\n\n\n\n\n\n\nRealizamos la predicción para el escenario climático escogido.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_maxent_2041_2060 <- predict(modelo_maxent, ca_bio_2041_2060)\n```\n:::\n\n\n\n\n\nElaboramos un mapa de la predicción.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  theme_minimal() +\n  geom_spatraster(data = mapa_maxent_2041_2060) +\n  scale_fill_whitebox_c(name = \"Calidad \\ndel hábitat\",\n                       palette = \"Bl_Yl_Rd\",\n                       na.value = NA,\n                       direction = 1)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n\nCombinamos ambos mapas para poder compararlos.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nambos <- c(mapa_maxent, mapa_maxent_2041_2060)\n```\n:::\n\n\n\nLe asignamos nombres a las capas.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(ambos) <- c(\"Actual\", \"Futuro\")\n```\n:::\n\n\n\nComo se puede ver, se registran cambios en la calidad del hábitat para el escenario climático utilizado.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  theme_minimal() +\n  geom_spatraster(data = ambos) +\n  facet_wrap(~ lyr) +\n  scale_fill_whitebox_c(name = \"Calidad \\ndel hábitat\",\n                       palette = \"Bl_Yl_Rd\",\n                       na.value = NA,\n                       direction = 1)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n\n\nUna manera de cuantificar los cambios en un escenario futuro es transformar la calidad del hábitat, por ejemplo, en 5 categorías.\n\n\n\n\n\n\n\n\n\n\n\nLo hacemos para el mapa de calidad de hábitat actual.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_maxent_c <- classify(mapa_maxent, rclmat, include.lowest = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(mapa_maxent_c) <- clases\n```\n:::\n\n\n\n\n\nLo hacemos para el mapa de calidad de hábitat en el futuro.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_maxent_2041_2060_c <- classify(mapa_maxent_2041_2060, rclmat, include.lowest = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(mapa_maxent_2041_2060_c) <- clases\n```\n:::\n\n\n\n\n\nCombinamos ambos mapas (rasters)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nambos_c <- c(mapa_maxent_c, mapa_maxent_2041_2060_c)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(ambos_c) <- c(\"Actual\", \"Futuro\")\n```\n:::\n\n\n\nElaboramos un gráfico con ambos mapas para hacer más fácil la comparación.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  theme_minimal() +\n  geom_spatraster(data = ambos_c, color = \"black\") +\n  facet_wrap(~ lyr) +\n  scale_fill_whitebox_d(name = \"Calidad \\ndel hábitat\",\n                       palette = \"Bl_Yl_Rd\",\n                       na.value = NA,\n                       direction = 1)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n:::\n\n\n\nLuego procesamos ambos mapas para poder contabilizar las celdas (pixeles) que corresponden a cada categoría de calidad del hábitat en el mapa actual y en el mapa futuro.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr_df <- as.data.frame(ambos_c) |>\n  drop_na()\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr_df_sankey <- r_df %>%\n  make_long(Actual, Futuro)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nr_df_sankey$node <- factor(r_df_sankey$node, levels = c(\"Muy bajo\", \"Bajo\", \"Medio\", \"Alto\", \"Muy alto\"))\n```\n:::\n\n\n\n\n\nElaboramos un sankey plot para visualizar la transformación de las celdas (pixeles) entre diferentes categorías de calidad del hábitat entre el mapa actual y el mapa futuro. .\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(r_df_sankey, aes(x = x, \n               next_x = next_x, \n               node = node, \n               next_node = next_node,\n               fill = factor(node),\n               label = node)) +\n  theme_sankey(base_size = 18) +\n  labs(x = NULL) +\n  geom_sankey(flow.alpha = 0.5\n                      , node.color = \"black\"\n                      ,show.legend = FALSE) +\n  geom_sankey_label(size = 3, color = \"black\", fill= \"white\", hjust = -0.5) +\n  scale_fill_brewer(palette = \"Set1\", direction=-1)\n```\n\n::: {.cell-output-display}\n![](actividad_2020_2022_files/figure-html/unnamed-chunk-56-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "actividad_2020_2022_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}